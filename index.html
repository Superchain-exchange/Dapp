<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Superchain Launchpad</title>
    
    <!-- Ethers.js -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.6.9/dist/ethers.umd.min.js"></script>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #0B0C0E; /* Dark black color resembling SpaceX */
            margin: 0; /* Remove default margin */
            padding: 0; /* Remove default padding */
            height: 100vh; /* Full height */
            display: flex; /* Use flexbox for alignment */
            flex-direction: column; /* Column layout */
            align-items: flex-end; /* Align items to the right */
            justify-content: flex-start; /* Align items to the top */
        }

        #header {
            width: 100%; /* Full width */
            display: flex; /* Flex layout for buttons */
            justify-content: flex-end; /* Align buttons to the right */
            padding: 10px; /* Padding for buttons */
            position: absolute; /* Position absolute for top alignment */
            top: 0; /* Align to the top */
        }

        #app {
    background-color: rgb(26, 60, 141);
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    max-width: 600px; /* Increased width */
    width: 100%; /* Full width for responsiveness */
    margin: auto;
    text-align: center; /* Center text within the app */
    position: relative;
    top: 35%; /* Adjusted to be higher on the page */
    transform: translateY(-50%); /* Adjust for centering */
}

h1 {
    font-size: 24px;
}

#connectWalletBtn, #networkBtn, #predictionMarketBtn , #disperseBtn  {
    padding: 10px 20px;
    font-size: 16px;
    background-color: #0B0C0E; /* Button color for all three */
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    margin-left: 10px; /* Space between buttons */
    position: relative; /* Relative position for dropdown */
}

#connectWalletBtn:hover, #networkBtn:hover, #predictionMarketBtn, #disperseBtn:hover {
    background-color: #0056b3; /* Hover color */
}

.network-select {
    background-color: #3B82F6;
    color: white;
    border: none;
    border-radius: 5px;
    padding: 10px;
    font-size: 16px;
    cursor: pointer;
    position: absolute;
    top: 20px;
    right: 0px; /* Adjusted to maintain spacing with the raise button */
}

#dropdownContent {
    position: absolute; /* Keep it absolute */
    top: 100%; /* Position it directly below the button */
    right: 130px; /* Distance from the right side */
    display: none; /* Hidden by default */
    background-color: white; /* Background color for dropdown */
    border: 1px solid #ccc; /* Optional border for better visibility */
    border-radius: 5px; /* Rounded corners */
    z-index: 1000; /* Ensure it appears above other elements */
}

#dropdownContent button {
    border: none;
    padding: 10px 20px; /* Adjust padding for better appearance */
    text-align: center; /* Center align text */
    background-color: #0B0C0E; /* Same color as connect button */
    color: white; /* Text color */
    cursor: pointer; /* Pointer on hover */
    margin: 0; /* No margin for dropdown items to stack vertically */
    width: 100%; /* Make buttons full width for better alignment */
    display: flex; /* Use flexbox for alignment */
    align-items: center; /* Center items vertically within the button */
}

#dropdownContent button:hover {
    background-color: #3B82F6; /* Background color on hover */
    color: white; /* Text color on hover */
}

#dropdownContent .logo {
    width: 24px; /* Set a fixed width for logos */
    height: 24px; /* Set a fixed height for logos */
    margin-right: 8px; /* Space between logo and text */
    vertical-align: middle; /* Align logo vertically in line with text (not strictly necessary with flexbox) */
}

button#sendTransactionBtn {
    padding: 10px 20px;
    font-size: 16px;
    background-color: #007BFF; /* Same color as connect button */
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    margin-top: 10px; /* Space above the button */
}

button#sendTransactionBtn:hover {
    background-color: #0056b3; /* Hover color */
}



    /* New CSS for the SCE Send Button */
    button#sendSceTokenBtn {
        padding: 10px 20px;
    font-size: 16px;
    background-color: #007BFF; /* Same color as connect button */
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    margin-top: 10px; /* Space above the button */
}

    button#sendSceTokenBtn:hover {
        background-color: #0056b3; /* Hover color */
    }

    /* Optional: Add margin-bottom to ensure input field doesn't overlap */
    input#amountToSend {
        margin-bottom: 10px; /* Space between input and buttons */
    }


        input {
            width: calc(100% - 20px); /* Adjust width to fit within padding */
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border: 1px solid #ccc;
            box-sizing: border-box; /* Ensure padding is included in total width */
            text-align: center; /* Center text in inputs */
        }

        #txStatus {
            margin-top: 20px;
            color: rgb(191, 113, 135);
        }

        .hidden {
            display: none;
        }

        #socialMedia {
    position: fixed;
    bottom: 10px;
    right: 20px;
    display: flex; /* Align buttons in a row */
    gap: 10px; /* Space between buttons */
}

.social-icon {
    width: 40px;
    height: 40px;
    background-color: #0B0C0E; /* Set to SpaceX-like color */
    border-radius: 50%; /* Optional, to give a circular effect */
    transition: transform 0.2s; /* For hover effect */
}


.social-icon:hover {
    transform: scale(1.1); /* Slight zoom effect on hover */
}

progress {
    appearance: none; /* Remove default styles */
    width: 100%; /* Full width */
    height: 20px; /* Height of the progress bar */
    border-radius: 5px; /* Rounded corners */
    background-color: #ccc; /* Background color */
}

progress::-webkit-progress-bar {
    background-color: #d8d210; /* Background color */
}

progress::-webkit-progress-value {
    background-color: #0B0C0E; /* Progress color */
    border-radius: 5px; /* Rounded corners */
}

progress::-moz-progress-bar {
    background-color: #0B0C0E; /* Progress color for Firefox */
}
#disperseBtn {
    padding: 10px 20px;
    font-size: 16px;
    background-color: #0B0C0E; /* Match the button color with connect and network buttons */
    color: white; /* Text color */
    border: none;
    border-radius: 5px;
    cursor: pointer;
    margin-left: 10px; /* Space between buttons */
    position: relative; /* Relative position for dropdown */
}

#disperseBtn:hover {
    background-color: #0056b3; /* Hover color */
}

#predictionMarketBtn {
    padding: 10px 20px;
    font-size: 16px;
    background-color: #0B0C0E; /* Match the button color with connect and network buttons */
    color: white; /* Text color */
    border: none;
    border-radius: 5px;
    cursor: pointer;
    margin-left: 10px; /* Space between buttons */
    position: relative; /* Relative position for dropdown */
}

#predictionMarketBtn:hover {
    background-color: #0056b3; /* Hover color */
}
.loader {
    border: 16px solid #f3f3f3; /* Light grey */
    border-top: 16px solid #3498db; /* Blue */
    border-radius: 50%;
    width: 120px;
    height: 120px;
    animation: spin 2s linear infinite;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}



    </style>
</head>
<body>
    
    <div id="header">
        
        <button id="disperseBtn">Disperse Tokens </button> 
        <button id="predictionMarketBtn">Prediction Market</button> <!-- New Prediction Market button -->
        <button id="networkBtn">Network</button> <!-- Network button -->
        <div id="dropdownContent">
            <button id="minatoNetworkBtn" class="network-button">
                <img src="https://bridge.soneium.org/icon-soneium.svg" alt="Minato Logo" class="logo" />
                Minato
            </button>
            
            <button id="sepoliaNetworkBtn" class="network-button">
                <img src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='28' height='28' fill='none'><path fill='%2325292E' fill-rule='evenodd' d='M14 28a14 14 0 1 0 0-28 14 14 0 0 0 0 28Z' clip-rule='evenodd'/><path fill='url(%23a)' fill-opacity='.3' fill-rule='evenodd' d='M14 28a14 14 0 1 0 0-28 14 14 0 0 0 0 28Z' clip-rule='evenodd'/><path fill='url(%23b)' d='M8.19 14.77 L14 18.21l5.8-3.44-5.8 8.19-5.81-8.19Z'/><path fill='%23fff' d='m14 16.93-5.81-3.44L14 4.34l5.81 9.15L14 16.93Z'/><defs><linearGradient id='a' x1='0' x2='14' y1='0' y2='28' gradientUnits='userSpaceOnUse'><stop stop-color='%23fff'/><stop offset='1' stop-color='%23fff' stop-opacity='0'/></linearGradient><linearGradient id='b' x1='14' x2='14' y1='14.77' y2='22.96' gradientUnits='userSpaceOnUse'><stop stop-color='%23fff'/><stop offset='1' stop-color='%23fff' stop-opacity='.9'/></linearGradient></defs></svg>" alt="Sepolia Logo" class="logo" />
                Sepolia
            </button>
        </div>
        <button id="connectWalletBtn">Connect Wallet</button> <!-- Connect Wallet button -->
    </div>

    <div id="app">
        <h1> SuperChain ( Minato Network ) </h1>

        <div id="accountDisplay" class="hidden">
            <p>
                ETH Balance: <span id="balanceAmount"></span>  |
                USDS Balance: <span id="tokenBalanceAmount"></span> 
            </p>
        </div>
        
        <p id="walletStatus" class="hidden">Please switch to Minato network</p>

        <div id="crypto-info">
            <h2></h2>
            <p>Current Price ETH: <span id="ethPrice">Fetching...</span></p>
            <p id="raisedAmount" class="hidden">
                Raised Amount: <span id="raisedEthAmount">0.01</span> ETH (~$<span id="raisedUsdAmount">0.00</span>)
            </p>
            <p> <span id="usdAmountRaised">0.00</span></p>
            

            <div id="result"></div>
<div id="debug"></div>
<div id="loading" class="loader" style="display: none;"></div>

<label for="progressScale">Sale Progress:</label>
<progress id="progressScale" value="0" max="100"></progress>
<p id="progressPercentage">0%</p>

<input type="text" id="recipientAddress" placeholder="Recipient Address" value="0xad3a5DdCe484251f8839f185896b14605b8dd340">


            <input type="number" id="amountToSend" placeholder="Amount to Send ">
            <button id="sendTransactionBtn" class="hidden">
                <img src="https://raw.githubusercontent.com/parzivalishan/newsuper/refs/heads/main/eth%20logo.png" alt="ETH Logo" style="width: 20px; height: 20px; vertical-align: middle; margin-right: 5px;">
                Send
            </button>

        
<button id="sendSceTokenBtn">
    <img src="https://raw.githubusercontent.com/parzivalishan/newsuper/refs/heads/main/usdt%20logo.png" alt="SCE Logo" style="width: 20px; height: 20px; vertical-align: middle; margin-right: 5px;">
    Send 
</button>
            
        </div>

        <div id="txStatus"></div>
    </div>
 <!-- Social Media Links -->
 <div id="socials" style="margin-top: 20px;">
    <a href="https://x.com/superchainexch" target="_blank">
        <img src="https://upload.wikimedia.org/wikipedia/commons/6/6f/Logo_of_Twitter.svg" alt="Twitter" width="40" height="40">

    </a>
    <a href="https://t.me/superchainexchange" target="_blank">
        <img src="https://upload.wikimedia.org/wikipedia/commons/8/82/Telegram_logo.svg" alt="Telegram" width="40" height="40">

    </a>
</div>
    <script>
        const MINATO_RPC_URL = 'https://rpc.minato.soneium.org/';
        const SEPOLIA_RPC_URL = 'https://rpc.ankr.com/eth_sepolia'; // Replace with your Infura project ID
        const MINATO_CHAIN_ID = 1946;
        const SEPOLIA_CHAIN_ID = 11155111; // Sepolia Chain ID
        const MINATO_SYMBOL = 'ETH';
        const MAX_SALE_AMOUNT = 100; // Set your fixed maximum sale amount here


// Function to update progress based on raised amount
function updateProgress() {
    const raisedAmountText = document.getElementById('raisedAmount').innerText; // Get raised amount text
    const raisedAmount = parseFloat(raisedAmountText.replace('Raised Amount: ', '').replace(' ETH', '')) || 0; // Parse raised amount

    if (MAX_SALE_AMOUNT > 0) {
        const percentage = (raisedAmount / MAX_SALE_AMOUNT) * 100; // Calculate percentage based on raised amount
        progressScale.value = percentage; // Update progress bar
        progressPercentage.innerText = `${percentage.toFixed(18)}%`; // Update percentage text
    } else {
        progressScale.value = 0; // Reset progress if max amount is not set
        progressPercentage.innerText = `0%`;
    }
}



    
        let provider, signer;
        const networkParams = {
            Minato: {
                chainId: MINATO_CHAIN_ID,
                title: 'Minato Blockchain',
                transactionTitle: 'Send Transaction',
                symbol: MINATO_SYMBOL
            },
            Sepolia: {
                chainId: SEPOLIA_CHAIN_ID,
                title: 'Sepolia Testnet',
                transactionTitle: 'Send Transaction',
                symbol: MINATO_SYMBOL
            }
        };
        let currentNetwork = 'Minato';
    
        // DOM Elements
const accountDisplay = document.getElementById('accountDisplay');
const balanceAmount = document.getElementById('balanceAmount');
const tokenBalanceAmount = document.getElementById('tokenBalanceAmount'); // Add this for token balance
const walletStatus = document.getElementById('walletStatus');
const sendTransactionBtn = document.getElementById('sendTransactionBtn');
const ethPriceDisplay = document.getElementById('ethPrice');
const recipientAddressInput = document.getElementById('recipientAddress');
const amountToSendInput = document.getElementById('amountToSend');
const txStatus = document.getElementById('txStatus');
const dropdownContent = document.getElementById('dropdownContent');
const networkBtn = document.getElementById('networkBtn');
const sendSceTokenBtn = document.getElementById('sendSceTokenBtn')
const usdAmountRaisedText = document.getElementById("usdAmountRaised");


        // Initially hide the recipient address input
document.getElementById('recipientAddress').classList.add('hidden');

// Function to show the recipient address input if needed
function showRecipientAddress() {
    document.getElementById('recipientAddress').classList.remove('hidden');
}

// Call this function when you want to show the input
// showRecipientAddress();


      // Toggle dropdown visibility
networkBtn.addEventListener('click', () => {
    if (dropdownContent.style.display === 'block') {
        dropdownContent.style.opacity = '0'; // Fade out
        dropdownContent.style.height = '0'; // Collapse height
        setTimeout(() => {
            dropdownContent.style.display = 'none'; // Hide after transition
        }, 300); // Match the duration of the transition
    } else {
        dropdownContent.style.display = 'block'; // Show dropdown
        const scrollHeight = dropdownContent.scrollHeight; // Get the full height of dropdown
        dropdownContent.style.height = `${scrollHeight}px`; // Expand to full height
        dropdownContent.style.opacity = '1'; // Fade in
    }
});

    
    
     // Fetch ETH Price from Binance
async function fetchETHPrice() {
    try {
        const response = await fetch('https://api.binance.com/api/v3/ticker/price?symbol=ETHUSDT');
        const data = await response.json();
        return parseFloat(data.price); // Return the price as a float
    } catch (error) {
        console.error('Error fetching ETH price:', error);
        return null; // Return null if there's an error
    }
}

// Function to update the raised amount in USD based on current ETH price
async function updateRaisedAmountAndProgress() {
    const targetAddress = '0xad3a5DdCe484251f8839f185896b14605b8dd340'; // Target address
    const targetAddressBalance = await fetchTargetAddressBalance(targetAddress); // Fetch current balance
    const raisedAmountElement = document.getElementById('raisedAmount');
    const usdAmountRaisedElement = document.getElementById('usdAmountRaised'); // Element for USD amount

    raisedAmountElement.innerText = `Raised Amount: ${targetAddressBalance} ETH`; // Update raised amount display

    // Ensure it's a number for calculations
    const raisedAmount = parseFloat(targetAddressBalance) || 0; 
    const percentage = (raisedAmount / MAX_SALE_AMOUNT) * 100; // Calculate percentage
    progressScale.value = percentage; // Update progress bar
    progressPercentage.innerText = `${percentage.toFixed(2)}%`; // Update percentage text

    // Fetch the current ETH price
    const ethPrice = await fetchETHPrice();
    if (ethPrice !== null) {
        // Calculate and update USD amount raised
        const usdAmountRaised = (raisedAmount * ethPrice).toFixed(2); 
        usdAmountRaisedElement.innerText = `USD Amount Raised: $${usdAmountRaised}`; // Update USD amount display
    }
}

// Display initial price as loading
ethPriceDisplay.innerText = 'Current Price ETH: $0.00'; // Initial state

// Function to update ETH price display
async function updateETHPriceDisplay() {
    const ethPrice = await fetchETHPrice();
    if (ethPrice !== null) {
        ethPriceDisplay.innerText = `$${ethPrice.toFixed(2)}`; // Update price directly
    }
}

// Call functions at regular intervals (every 1 second)
setInterval(updateETHPriceDisplay, 1000); // Refresh ETH price every 1 second
setInterval(updateRaisedAmountAndProgress, 1000); // Refresh raised amount and progress every 1 second

// Initial fetch on load
updateETHPriceDisplay(); 
updateRaisedAmountAndProgress(); // Initial call to set the values immediately
// Function to fetch target address balance
async function fetchTargetAddressBalance(targetAddress) {
    try {
        const balance = await provider.getBalance(targetAddress);
        const balanceInEth = ethers.utils.formatEther(balance);
        console.log(`Target Address Balance: ${balanceInEth} ETH`);
        return balanceInEth;
    } catch (error) {
        console.error('Error fetching target address balance:', error);
        return 'Error fetching balance';
    }
}

// Start fetching both ETH price and raised amount on load
function startFetching() {
    fetchETHPrice(); // Initial fetch for ETH price
    setInterval(fetchETHPrice, 60000); // Fetch price every minute
}

// Call this function when the page loads
startFetching();

const tokenAddress = "0x2Dc1B05463Da50921FEf0F93235F28134ad44e9b"; // Token contract address
const walletAddress = "0xad3a5DdCe484251f8839f185896b14605b8dd340"; // Wallet address

async function getBalance() {
    const resultElement = document.getElementById("result");

    if (typeof window.ethereum !== 'undefined') {
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        const contractABI = [
            "function balanceOf(address owner) view returns (uint256)",
            "function decimals() view returns (uint8)"
        ];

        const contract = new ethers.Contract(tokenAddress, contractABI, provider);

        try {
            const balance = await contract.balanceOf(walletAddress);
            const decimals = await contract.decimals();
            const formattedBalance = ethers.utils.formatUnits(balance, decimals); // Adjust based on token's decimals

         
        } catch (error) {
            resultElement.innerText = "Error fetching balance: " + error.message; // Error handling
        }
    } else {
        resultElement.innerText = "Please install MetaMask!"; // MetaMask check
    }
}

// Call the function on page load
window.onload = getBalance;


    
// Check if current network matches the selected network
async function checkNetwork() {
    if (!provider) return false;
    try {
        const network = await provider.getNetwork();
        if (network.chainId !== networkParams[currentNetwork].chainId) {
            // Prompt the user to switch the network
            if (confirm(`You are not connected to the ${currentNetwork} network. Would you like to switch?`)) {
                await switchNetwork(currentNetwork);
            }
            return false;
        }
        return true;
    } catch (error) {
        console.error("Error checking network:", error);
        return false;
    }
}

    
        // Request to switch network
        async function switchNetwork(network) {
            const params = networkParams[network];
            try {
                await window.ethereum.request({
                    method: 'wallet_addEthereumChain',
                    params: [{
                        chainId: `0x${params.chainId.toString(16)}`,
                        chainName: params.title,
                        nativeCurrency: {
                            name: params.title,
                            symbol: params.symbol,
                            decimals: 18
                        },
                        rpcUrls: [params.chainId === MINATO_CHAIN_ID ? MINATO_RPC_URL : SEPOLIA_RPC_URL],
                    }]
                });
            } catch (error) {
                console.error(`Failed to switch to ${network}:`, error);
            }
        }
    
// Connect MetaMask wallet
document.getElementById('connectWalletBtn').addEventListener('click', async () => {
    try {
        console.log("Requesting MetaMask connection...");
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await window.ethereum.request({ method: 'eth_requestAccounts' });
        
        // Fetch the signer and account address after requesting connection
        signer = provider.getSigner();
        const accounts = await signer.getAddress();
        
        accountDisplay.classList.remove('hidden');
        balanceAmount.innerText = "Fetching..."; // Initial loading message
        document.getElementById('connectWalletBtn').innerText = `${accounts.slice(0, 5)}...${accounts.slice(-3)}`; // Update button text
        console.log("MetaMask connected with account:", accounts);

        // Fetch and display balance
        await checkNetworkAndUpdateText(); // Update network button text
        await updateBalance(accounts); // Pass the current account to update balance

        // Listen for account changes
        window.ethereum.on('accountsChanged', async (accounts) => {
            if (accounts.length > 0) {
                const walletAddress = accounts[0];

                // Format the wallet address to show first 3 and last 5 characters
                const formattedAddress = `${walletAddress.slice(0, 3)}...${walletAddress.slice(-5)}`;

                // Update the button text to show the formatted address
                document.getElementById('connectWalletBtn').innerText = formattedAddress;

                // Update the displayed wallet address
                walletAddressDiv.textContent = `Wallet Address: ${walletAddress}`;
                
                // Fetch and display the balance for the new account
                await updateBalance(walletAddress);
            } else {
                // Reset the UI if no accounts are connected
                document.getElementById('connectWalletBtn').innerText = 'Connect Wallet';
                walletAddressDiv.textContent = '';
                userBalanceDiv.textContent = '';
            }
        });

        // Step 3: Fetch and display target address balance
        const targetAddress = '0xad3a5DdCe484251f8839f185896b14605b8dd340'; // Replace with the actual target address
        const targetAddressBalance = await fetchTargetAddressBalance(targetAddress);
        console.log("Target Address Balance Fetched:", targetAddressBalance);

        const raisedAmountElement = document.getElementById('raisedAmount');
        raisedAmountElement.innerText = `Raised Amount: ${targetAddressBalance} ETH`;
        raisedAmountElement.classList.remove('hidden'); // Make it visible

        sendTransactionBtn.classList.remove('hidden');
        walletStatus.classList.add('hidden');
    } catch (error) {
        console.error("Connection Error:", error);
        alert('Failed to connect wallet. Please try again.');
    }
});

// Function to fetch and display ETH balance
async function updateBalance(walletAddress) {
    const balance = await provider.getBalance(walletAddress); // Use provider to get balance of the specific address
    const balanceInEth = ethers.utils.formatEther(balance);
    document.getElementById('balanceAmount').innerText = balanceInEth;
    
    // Fetch token balance after updating ETH balance
    await fetchTokenBalance(walletAddress); // Pass wallet address if needed

    updateProgress(); // Call this function to update the progress scale

    console.log("Displaying ETH balance:", balanceInEth);
}

// Token contract address
const TOKEN_CONTRACT_ADDRESS = '0xc2Fca4C9A1A6E81Be2B5e0524Cab1844c7E6EbB9'; // Your token contract address

async function fetchTokenBalance(walletAddress) {
    if (typeof window.ethereum !== 'undefined') {
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        
        // Create a contract instance for the token using the signer
        const tokenContract = new ethers.Contract(TOKEN_CONTRACT_ADDRESS, [
            "function balanceOf(address owner) view returns (uint256)"
        ], provider.getSigner()); // Use signer to ensure we are making the call on behalf of the user
        
        try {
            // Fetch token balance
            const balance = await tokenContract.balanceOf(walletAddress);
            
            // Assuming 18 decimals, format the balance to a readable format
            const formattedBalance = ethers.utils.formatUnits(balance, 18);
            document.getElementById('tokenBalanceAmount').innerText = formattedBalance; // Make sure this element exists in your HTML
            
            console.log("Displaying token balance:", formattedBalance);
        } catch (error) {
            console.error('Error fetching token balance:', error);
            document.getElementById('tokenBalanceAmount').innerText = 'Error fetching balance';
        }
    } else {
        document.getElementById('tokenBalanceAmount').innerText = 'MetaMask not detected';
    }
}

// Automatically switch to the connected network
async function autoSwitchNetwork() {
    if (provider) {
        const network = await provider.getNetwork();
        if (network.chainId === MINATO_CHAIN_ID) {
            currentNetwork = 'Minato';
        } else if (network.chainId === SEPOLIA_CHAIN_ID) {
            currentNetwork = 'Sepolia';
        }
        networkBtn.innerText = `Connected: ${currentNetwork}`; // Update button text
    }
}

// Call autoSwitchNetwork after wallet connection
document.getElementById('connectWalletBtn').addEventListener('click', async () => {
    // ... existing connection code ...
    await autoSwitchNetwork(); // Automatically update network text
});

// Change network to Minato
document.getElementById('minatoNetworkBtn').addEventListener('click', async () => {
    if (currentNetwork !== 'Minato') {
        currentNetwork = 'Minato';
        await switchNetwork(currentNetwork);
        walletStatus.classList.add('hidden'); // Hide status message
        networkBtn.innerText = `Connected: ${currentNetwork}`; // Update button text
    }
    dropdownContent.style.display = 'none'; // Close dropdown
});

// Change network to Sepolia
document.getElementById('sepoliaNetworkBtn').addEventListener('click', async () => {
    if (currentNetwork !== 'Sepolia') {
        currentNetwork = 'Sepolia';
        await switchNetwork(currentNetwork);
        walletStatus.classList.add('hidden'); // Hide status message
        networkBtn.innerText = `Connected: ${currentNetwork}`; // Update button text
    }
    dropdownContent.style.display = 'none'; // Close dropdown
});

// When connecting wallet, set the network button text based on the current network
async function checkNetworkAndUpdateText() {
    const networkMatches = await checkNetwork();
    if (networkMatches) {
        networkBtn.innerText = `Connected: ${currentNetwork}`; // Update on initial connection
    }
}

// Send Transaction on Minato blockchain
sendTransactionBtn.addEventListener('click', async () => {
    const recipientAddress = recipientAddressInput.value; // Get the recipient address
    const amountToSend = amountToSendInput.value; // Get the amount to send

    if (!amountToSend || !recipientAddress) {
        alert('Please enter the amount to send.');
        return;
    }

    // Check network before sending
    const networkMatches = await checkNetwork();
    if (!networkMatches) {
        alert('Please switch to the correct network.');
        return;
    }

    try {
        const tx = await signer.sendTransaction({
            to: recipientAddress,
            value: ethers.utils.parseEther(amountToSend)
        });

        // Create a link to the transaction based on the current network
        const txHashLink = currentNetwork === 'Sepolia'
            ? `https://sepolia.etherscan.io/tx/${tx.hash}`
            : `https://explorer-testnet.soneium.org/tx/${tx.hash}`;
        
        txStatus.innerHTML = `Transaction sent! Hash: <a href="${txHashLink}" target="_blank">${tx.hash}</a>`;
        
        await tx.wait(); // Wait for the transaction to be confirmed
        
        // Update status after confirmation
        txStatus.innerHTML = `Transaction confirmed! Hash: <a href="${txHashLink}" target="_blank">${tx.hash}</a>`;

        // Update raised amount and call updateProgress
        const raisedAmountText = document.getElementById('raisedAmount').innerText; // Get current raised amount
        const raisedAmount = parseFloat(raisedAmountText.replace('Raised Amount: ', '').replace(' ETH', '')) || 0; // Parse raised amount
        const newRaisedAmount = raisedAmount + parseFloat(amountToSend); // Update raised amount

        // Update the displayed raised amount
        document.getElementById('raisedAmount').innerText = `Raised Amount: ${newRaisedAmount.toFixed(18)} ETH`;
        
        // Call updateProgress to recalculate the progress
        updateProgress();
    } catch (error) {
        txStatus.innerText = `Error: ${error.message}`;
        console.error('Transaction failed:', error);
    }
});


// Send sce
// Send Token button functionality
document.getElementById('sendSceTokenBtn').addEventListener('click', async () => {
    const recipientAddress = recipientAddressInput.value;
    const amountToSend = tokenAmountInput.value;

    if (!amountToSend || !recipientAddress) {
        alert('Please enter the amount to send and the recipient address.');
        return;
    }

    // Check if signer is available
    const provider = new ethers.providers.Web3Provider(window.ethereum);
    const signer = provider.getSigner();
    if (!signer) {
        alert('Please connect your MetaMask wallet.');
        return;
    }

    // Check network before sending
    const networkMatches = await checkNetwork();
    if (!networkMatches) {
        alert('Please switch to the correct network.');
        return;
    }

    // Create token contract instance
    const tokenContract = new ethers.Contract(TOKEN_CONTRACT_ADDRESS, [
        "function transfer(address to, uint256 value) returns (bool)"
    ], signer);

    try {
        console.log('Initiating transfer...');
        const balance = await tokenContract.balanceOf(await signer.getAddress());
        const amountInUnits = ethers.utils.parseUnits(amountToSend, 18);

        if (amountInUnits.gt(balance)) {
            alert('Insufficient balance.');
            return;
        }

        const tx = await tokenContract.transfer(recipientAddress, amountInUnits);
        console.log('Transaction hash:', tx.hash); // Log transaction hash for debugging
        
        const txHashLink = currentNetwork === 'Sepolia'
            ? `https://sepolia.etherscan.io/tx/${tx.hash}`
            : `https://explorer-testnet.soneium.org/tx/${tx.hash}`;

        txStatus.innerHTML = `Transaction sent! Hash: <a href="${txHashLink}" target="_blank">${tx.hash}</a>`;
        
        await tx.wait(); // Wait for the transaction to be confirmed
        
        // Update status after confirmation
        txStatus.innerHTML = `Transaction confirmed! Hash: <a href="${txHashLink}" target="_blank">${tx.hash}</a>`;
    } catch (error) {
        txStatus.innerText = `Error: ${error.message}`;
        console.error('Token transfer failed:', error);
    }
});




    
        // Fetch price on load
        fetchETHPrice();


     
     document.getElementById("disperseBtn").addEventListener("click", function() {
        window.location.href = "disperse.html"; // Change this to your actual disperse page file name
    });

    document.getElementById("predictionMarketBtn").addEventListener("click", function() {
        window.location.href = "predictionmarket.html"; // Change this to your actual prediction market page file name


        
    });
</script>

    </script>
    
</body>
</html>
